import{a as v,j as e,I as f,r as u,i as x,au as i,aw as N,m as b,aN as w,W as A}from"./index-DRzNUvPi.js";import{S}from"./SelectField-CrNwXiMd.js";function C({defaultValues:s,onSubmit:d,onCancel:h}){const{register:r,handleSubmit:o,formState:{errors:a,isSubmitting:m}}=v({defaultValues:{discount:s.discount??"",maxAge:s.maxAge??"",maxUsageLimit:s.maxUsageLimit??"",status:s.status?"active":"inactive"}}),g=n=>d({discount:Number(n.discount),maxAge:Number(n.maxAge),maxUsageLimit:Number(n.maxUsageLimit),status:n.status==="active"});return e.jsxs("form",{onSubmit:o(g),className:"space-y-4",children:[e.jsx(f,{label:"Discount (%)",name:"discount",type:"number",register:r,errors:a,rules:{required:"Discount is required",min:{value:0,message:"Min 0%"},max:{value:51,message:"Max 51%"}}}),e.jsx(f,{label:"Max Age (hours)",name:"maxAge",type:"number",register:r,errors:a,rules:{required:"Max age is required",min:{value:1,message:"Min 1 hour"}}}),e.jsx(f,{label:"Usage Limit",name:"maxUsageLimit",type:"number",register:r,errors:a,rules:{required:"Usage limit is required",min:{value:1,message:"Min 1 use"}}}),e.jsx(S,{label:"Status",name:"status",register:r,errors:a,rules:{required:"Status is required"},options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",disabled:m,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-700",disabled:m,children:s._id?"Update":"Create"})]})]})}function M(){const[s,d]=u.useState(null),[h,r]=u.useState(!0),[o,a]=u.useState(null),[m,g]=u.useState(!1);u.useEffect(()=>{(async()=>{try{const{data:t}=await x.get("/admin/offer");d(t||null)}catch(t){console.error(t),i.error("Could not load offer.")}finally{r(!1)}})()},[]);const n=async()=>{try{const{data:t}=await x.get("/admin/offer");d(t||null)}catch(t){console.error(t)}},p=async t=>{const l=!!s,c=i.loading(l?"Updating…":"Creating…");try{l?(await x.put("/admin/offer/update",t),i.success("Offer updated",{id:c})):(await x.post("/admin/offer/create",t),i.success("Offer created",{id:c})),a(null),n()}catch(j){console.error(j),i.error("Failed to save.",{id:c})}},y=async()=>{g(!0);const t=i.loading("Deleting…");try{await x.delete(`/admin/offer/${s._id}`),i.success("Offer deleted",{id:t}),d(null)}catch(l){console.error(l),i.error("Delete failed",{id:t})}finally{g(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Site Offer"}),e.jsxs("button",{onClick:()=>a(s?"edit":"create"),className:"flex items-center gap-2 bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-700",children:[e.jsx(N,{}),s?"Edit":"Add"]})]}),h?e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]}):s?e.jsxs(b.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-white border border-gray-200 rounded-lg p-4 shadow",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Discount:"})," ",s.discount,"%"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Max Age:"})," ",s.maxAge," hrs"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Usage Limit:"})," ",s.maxUsageLimit]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",s.status?"Active":"Inactive"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Created At:"})," ",new Date(s.createdAt).toLocaleString()]}),e.jsx("div",{children:(()=>{const t=new Date(s.createdAt).getTime(),l=s.maxAge*60*60*1e3,c=Date.now()>t+l;return e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Expired:"})," ",e.jsx("span",{className:c?"text-red-600":"text-green-600",children:c?"Yes":"No"})]})})()})]}),e.jsxs("button",{onClick:()=>a("delete"),className:"mt-4 flex items-center gap-1 text-red-600 hover:text-red-800",children:[e.jsx(w,{})," Delete"]})]}):e.jsx("p",{className:"text-gray-600",children:"No offer configured."}),o==="create"||o==="edit"?e.jsx("div",{className:"fixed inset-0 glass bg-opacity-30 flex items-center justify-center z-50 p-4",children:e.jsxs(b.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white w-full max-w-md rounded-lg shadow-lg p-6 relative",children:[e.jsx("button",{onClick:()=>a(null),className:"absolute top-4 right-4 text-gray-600 hover:text-gray-800",children:e.jsx(A,{})}),e.jsx("h3",{className:"text-xl font-medium mb-4",children:s?"Edit Offer":"Create Offer"}),e.jsx(C,{defaultValues:s||{},onSubmit:p,onCancel:()=>a(null)})]})}):null,o==="delete"&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 p-4",children:e.jsxs(b.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},className:"bg-white max-w-sm w-full rounded-lg shadow-lg p-6",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Confirm Deletion"}),e.jsx("p",{className:"mb-4 text-gray-700",children:"Are you sure you want to delete this offer? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>a(null),className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",disabled:m,children:m?"Deleting…":"Delete"})]})]})})]})}export{M as default};
