import{a as D,j as e,m as u,ag as A,I as g,V as i,i as N,ah as S,a5 as _,ai as k,r as p,aj as F}from"./index-DRzNUvPi.js";function E({isOpen:r,setIsOpen:s,editAddress:a,setAddresses:l,defaultAddress:c}){const{register:t,handleSubmit:f,formState:{errors:o},reset:x}=D({defaultValues:a||{street:"",city:"",state:"",postalCode:"",country:"",phone:""}}),h=(m,d)=>JSON.stringify(m).toLowerCase()!==JSON.stringify(d).toLowerCase(),v=async m=>{try{if(a){if(!h(a,m)){i.error("No Changes Made To  Address");return}const d=i.loading("Please wait..."),{data:{address:y}}=await N.put(`/user/address/${a._id}`,m);l(b=>b.map(n=>n._id===a._id?y:n)),i.dismiss(d),i.success("Address Updated SuccessFully")}else{const d=i.loading("Please wait..."),{data:{address:y}}=await N.post("/user/address/add",m);l(b=>[...b,y]),i.dismiss(d),i.success("Address Added SuccessFully")}s(!1)}catch(d){console.error("Error saving address:",d)}};return e.jsx("div",{className:"fixed inset-0  glass bg-opacity-30 flex items-center justify-center z-50 p-4 sm:p-6",children:e.jsxs(u.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},className:"max-h-[90%] bg-white bg-opacity-50 backdrop-blur-md p-4 sm:p-6 w-full max-w-md sm:max-w-lg my-4 sm:my-0 shadow-lg border border-gray-300 border-opacity-20 rounded-lg relative overflow-y-scroll",children:[e.jsx("button",{onClick:()=>s(!1),className:"absolute top-4 right-4 text-foreground hover:text-foreground",children:e.jsx(A,{})}),e.jsx("h3",{className:"text-lg sm:text-xl font-semibold uppercase text-foreground mb-4 tracking-wide",children:a?"Edit Address":"Add Address"}),e.jsxs("form",{onSubmit:f(v),className:"space-y-4",children:[e.jsx(g,{label:"Street",name:"street",register:t,errors:o,rules:{required:"Street is required"}}),e.jsx(g,{label:"City",name:"city",register:t,errors:o,rules:{required:"City is required"}}),e.jsx(g,{label:"State",name:"state",register:t,errors:o,rules:{required:"State is required"}}),e.jsx(g,{label:"Postal Code",name:"postalCode",register:t,errors:o,rules:{required:"Postal code is required"}}),e.jsx(g,{label:"Country",name:"country",register:t,errors:o,rules:{required:"Country is required"}}),e.jsx(g,{label:"Phone",name:"phone",type:"tel",register:t,errors:o,rules:{required:"Phone number is required",pattern:{value:/^[6-9]\d{9}$/,message:"Enter a valid Indian phone number"}}}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-foreground text-white",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>s(!1),className:"px-4 py-2 bg-gray-200 mx-4",children:"Cancel"})]})]})})}function q({addresses:r,defaultAddress:s,handleEdit:a,handleDeleteClick:l,handleSetDefault:c}){return e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-4 p-0",children:r==null?void 0:r.map(t=>e.jsxs(u.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"relative bg-white rounded-lg shadow-sm border border-gray-200 p-4 md:p-5 hover:shadow-md transition-shadow duration-300 focus-within:ring-2 focus-within:ring-foreground",tabIndex:0,role:"region","aria-labelledby":`address-${t._id}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("h3",{id:`address-${t._id}`,className:"text-base md:text-lg font-semibold text-foreground truncate max-w-[70%]",children:[t.street,", ",t.city]}),((s==null?void 0:s._id)===t._id||r.length<=1)&&e.jsxs(u.span,{initial:{scale:.8},animate:{scale:1},className:"inline-flex items-center px-2 py-0.5 text-xs font-medium text-green-700 bg-green-100 rounded-full",children:[e.jsx(S,{className:"mr-1 h-3 w-3","aria-hidden":"true"}),"Default"]})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("p",{children:t.street}),e.jsxs("p",{children:[t.city,", ",t.state,","," ",t.postalCode]}),e.jsx("p",{children:t.country}),e.jsxs("p",{className:"mt-2",children:["Phone: ",t.phone]})]}),e.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[e.jsxs("div",{className:"relative group/edit",children:[e.jsx(u.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>a(t),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":`Edit address: ${t.street}, ${t.city}`,children:e.jsx(_,{className:"h-5 w-5"})}),e.jsx("span",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover/edit:opacity-100 transition-opacity duration-200 pointer-events-none",children:"Edit"})]}),e.jsxs("div",{className:"relative group/delete",children:[e.jsx(u.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>l(t._id),className:"p-2 text-red-600 hover:bg-red-50 rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500","aria-label":`Delete address: ${t.street}, ${t.city}`,children:e.jsx(k,{className:"h-5 w-5"})}),e.jsx("span",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover/delete:opacity-100 transition-opacity duration-200 pointer-events-none",children:"Delete"})]}),(s==null?void 0:s._id)!==t._id&&e.jsxs("div",{className:"relative group/default",children:[e.jsx(u.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:()=>c(t._id),className:"p-2 text-foreground hover:bg-gray-100 rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-foreground","aria-label":`Set as default address: ${t.street}, ${t.city}`,children:e.jsx(S,{className:"h-5 w-5"})}),e.jsx("span",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover/default:opacity-100 transition-opacity duration-200 pointer-events-none",children:"Set Default"})]})]})]},t._id))})}function $({isOpen:r,addressToDelete:s,setAddresses:a,setIsDeleteModalOpen:l,defaultAddress:c}){const t=async()=>{if(s===(c==null?void 0:c._id)){i.error("You Cant Delete Your Default Address");return}const o=i.loading("Please wait...");try{await N.delete(`/user/address/${s}`),a(x=>x.filter(h=>h._id!==s)),l(!1),i.success("Address deleted successfully")}catch(x){i.error("Failed to delete"),console.error("Error deleting address:",x)}finally{i.dismiss(o)}},f=()=>{l(!1)};return r&&e.jsx("div",{className:"fixed inset-0 glass bg-opacity-30 flex items-center justify-center z-50 p-4",children:e.jsxs(u.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3},className:"bg-white bg-opacity-50 backdrop-blur-md p-4 sm:p-6 w-full max-w-sm shadow-lg border border-gray-300 border-opacity-20 rounded-lg",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-foreground mb-4",children:"Confirm Deletion"}),e.jsx("p",{className:"text-foreground text-sm sm:text-base mb-6",children:"Are you sure you want to delete this address? This action cannot be undone."}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx("button",{onClick:t,className:"bg-red-600 text-white px-4 py-2 text-xs sm:text-sm",children:"Delete"}),e.jsx("button",{onClick:f,className:"bg-gray-200 text-foreground px-4 py-2 text-xs sm:text-sm",children:"Cancel"})]})]})})}function I(){const[r,s]=p.useState([]),[a,l]=p.useState(null),[c,t]=p.useState(!1),[f,o]=p.useState(null),[x,h]=p.useState(!1),[v,m]=p.useState(null);p.useEffect(()=>{(async()=>{try{const{data:j}=await N.get("/user/address/getAll");s(j.addresses)}catch(j){console.error("Error fetching addresses:",j)}})()},[]);const d=n=>{o(n),t(!0)},y=n=>{m(n),h(!0)},b=n=>{N.put(`/user/address/default/${n}`).then(j=>{l(C=>{var w;return(w=j.data)==null?void 0:w.defaultAddress}),s(C=>C.map(w=>({...w,isDefault:w._id===n}))),console.log("Addresses AFter Setting Default",r),console.log(a)})};return e.jsxs(u.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3},className:"space-y-4 sm:space-y-6 px-4 sm:px-6 md:px-0 lg:px-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("h2",{className:"flex items-center gap-2 text-lg sm:text-xl md:text-2xl font-semibold uppercase text-foreground tracking-wide",children:[e.jsx(F,{size:20})," Saved Addresses"]}),e.jsx("button",{onClick:()=>{t(!0),o(null)},className:"bg-foreground text-white px-4 py-2 text-xs sm:text-sm uppercase hover:bg-foreground/90 transition-colors duration-200 shadow-md w-full sm:w-auto",children:"Add Address"})]}),(r==null?void 0:r.length)===0?e.jsxs("div",{className:"text-center py-8 sm:py-12",children:[e.jsx("p",{className:"text-foreground text-sm sm:text-base mb-2",children:"No addresses saved"}),e.jsx("p",{className:"text-foreground text-xs sm:text-sm",children:"Add an address to see it here"})]}):e.jsx(q,{addresses:r,defaultAddress:a,handleEdit:d,handleDeleteClick:y,handleSetDefault:b},a),c&&e.jsx(E,{isOpen:c,setIsOpen:t,editAddress:f,setAddresses:s,defaultAddress:a}),x&&e.jsx($,{isOpen:x,addressToDelete:v,setAddresses:s,setIsDeleteModalOpen:h,defaultAddress:a})]})}export{I as default};
