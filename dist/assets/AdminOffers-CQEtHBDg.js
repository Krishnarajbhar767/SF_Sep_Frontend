import{a as A,j as e,I as f,r as m,l as h,h as v,ax as S,m as p,aN as C,X as D,au as c}from"./index-B8gvfyd-.js";import{S as O}from"./SelectField-CEdrnOpi.js";function M({defaultValues:n,onSubmit:g,onCancel:b}){const{register:o,handleSubmit:u,formState:{errors:t,isSubmitting:a}}=A({defaultValues:{discount:n.discount??"",maxAge:n.maxAge??"",maxUsageLimit:n.maxUsageLimit??"",status:n.status?"active":"inactive"}}),i=l=>g({discount:Number(l.discount),maxAge:Number(l.maxAge),maxUsageLimit:Number(l.maxUsageLimit),status:l.status==="active"});return e.jsxs("form",{onSubmit:u(i),className:"space-y-4",children:[e.jsx(f,{label:"Discount (%)",name:"discount",type:"number",register:o,errors:t,rules:{required:"Discount is required",min:{value:0,message:"Min 0%"},max:{value:51,message:"Max 51%"}}}),e.jsx(f,{label:"Max Age (hours)",name:"maxAge",type:"number",register:o,errors:t,rules:{required:"Max age is required",min:{value:1,message:"Min 1 hour"}}}),e.jsx(f,{label:"Usage Limit",name:"maxUsageLimit",type:"number",register:o,errors:t,rules:{required:"Usage limit is required",min:{value:1,message:"Min 1 use"}}}),e.jsx(O,{label:"Status",name:"status",register:o,errors:t,rules:{required:"Status is required"},options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",disabled:a,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-700",disabled:a,children:n._id?"Update":"Create"})]})]})}function E(){const[n,g]=m.useState([]),[b,o]=m.useState(!0),[u,t]=m.useState(null),[a,i]=m.useState(null),[l,j]=m.useState(!1);m.useEffect(()=>{y()},[]);const y=async()=>{try{const{data:s}=await h.get("/admin/offer");g(Array.isArray(s)?s:[])}catch(s){v(s)}finally{o(!1)}},N=async s=>{const r=!!a,d=c.loading(r?"Updating…":"Creating…");try{r?(await h.put(`/admin/offer/update/${a._id}`,s),c.success("Offer updated",{id:d})):(await h.post("/admin/offer/create",s),c.success("Offer created",{id:d})),t(null),i(null),y()}catch(x){console.error(x),v(x)}finally{c.dismiss(d)}},w=async()=>{if(!a)return;j(!0);const s=c.loading("Deleting…");try{await h.delete(`/admin/offer/delete/${a._id}`),c.success("Offer deleted",{id:s}),g(r=>r.filter(d=>d._id!==a._id))}catch(r){console.error(r),c.error("Delete failed",{id:s})}finally{j(!1),t(null),i(null)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Site Offers"}),e.jsxs("button",{onClick:()=>{t("create"),i(null)},className:"flex items-center gap-2 bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-700",children:[e.jsx(S,{})," Add"]})]}),b?e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]}):n.length?n.map(s=>e.jsxs(p.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-white border border-gray-200 rounded-lg p-4 shadow",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Discount:"})," ",s.discount,"%"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Max Age:"})," ",s.maxAge," hrs"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Usage Limit:"})," ",s.maxUsageLimit]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",s.status?"Active":"Inactive"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Created At:"})," ",new Date(s.createdAt).toLocaleString()]}),e.jsx("div",{children:(()=>{const r=new Date(s.createdAt).getTime(),d=s.maxAge*60*60*1e3,x=Date.now()>r+d;return e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Expired:"})," ",e.jsx("span",{className:x?"text-red-600":"text-green-600",children:x?"Yes":"No"})]})})()})]}),e.jsxs("div",{className:"mt-4 flex gap-4",children:[e.jsx("button",{onClick:()=>{i(s),t("edit")},className:"text-blue-600 hover:text-blue-800",children:"Edit"}),e.jsxs("button",{onClick:()=>{i(s),t("delete")},className:"text-red-600 hover:text-red-800 flex items-center gap-1",children:[e.jsx(C,{})," Delete"]})]})]},s._id)):e.jsx("p",{className:"text-gray-600",children:"No offers configured."}),(u==="create"||u==="edit")&&e.jsx("div",{className:"fixed inset-0 glass bg-opacity-30 flex items-center justify-center z-50 p-4",children:e.jsxs(p.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white w-full max-w-md rounded-lg shadow-lg p-6 relative",children:[e.jsx("button",{onClick:()=>{t(null),i(null)},className:"absolute top-4 right-4 text-gray-600 hover:text-gray-800",children:e.jsx(D,{})}),e.jsx("h3",{className:"text-xl font-medium mb-4",children:u==="edit"?"Edit Offer":"Create Offer"}),e.jsx(M,{defaultValues:a||{},onSubmit:N,onCancel:()=>{t(null),i(null)}})]})}),u==="delete"&&a&&e.jsx("div",{className:"fixed inset-0 glass bg-opacity-30 flex items-center justify-center z-50 p-4",children:e.jsxs(p.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},className:"bg-white max-w-sm w-full rounded-lg shadow-lg p-6",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Confirm Deletion"}),e.jsx("p",{className:"mb-4 text-gray-700",children:"Are you sure you want to delete this offer? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{t(null),i(null)},className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",disabled:l,children:l?"Deleting…":"Delete"})]})]})})]})}export{E as default};
