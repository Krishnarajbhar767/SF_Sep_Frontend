import{u as z,x as L,d as y,a as T,r as c,e as V,j as s,m as $,I as o,aC as X,W as Y,V as d,aD as B,h as G}from"./index-DRzNUvPi.js";import{S as v}from"./SelectField-CrNwXiMd.js";import{u as J}from"./uploadMedia-C7vyjgeF.js";import{p as K}from"./product.api-Bidbkf8n.js";const ae=()=>{const j=z(),{id:w}=L(),m=y(e=>e.fabrics),{products:g}=y(e=>e.product),P=y(e=>e.category.categories||[]),a=g==null?void 0:g.find(e=>e._id===w),{register:t,handleSubmit:A,formState:{errors:i},reset:q,watch:F}=T(),[u,N]=c.useState([]),[p,S]=c.useState([]),[C,f]=c.useState([]),[h,k]=c.useState(null),[x,I]=c.useState(!1),_=F(),D=V();c.useEffect(()=>{if(a){const e={name:a.name,description:a.description,price:a.price,stock:a.stock,category:a.category._id||a.category,fabric:a.fabric._id,technique:a.technique,color:a.color,weight:a.weight,assurance:a.assurance,hsnCode:a.hsnCode,isOfferAplied:a.isOfferAplied};q(e),k(e);const r=Array.isArray(a.images)?a.images:[];N(r),f(r)}},[a,q]);const O=e=>{const r=Array.from(e.target.files);S(n=>[...n,...r]);const l=r.map(n=>URL.createObjectURL(n));f(n=>[...n,...l])},E=e=>{if(f(r=>r.filter((l,n)=>n!==e)),e<u.length)N(r=>r.filter((l,n)=>n!==e));else{const r=e-u.length;S(l=>l.filter((n,b)=>b!==r))}},U=()=>{var e;if(!h)return!1;for(let r in h)if(String(_[r])!==String(h[r]))return!0;return p.length>0||u.length!==(((e=a.images)==null?void 0:e.length)||0)},R=async e=>{if(!U()){d.error("No changes detected.");return}I(!0);const r=d.loading("Please wait...");try{let l=[];p.length>0&&(l=await J(p,e));const n=Array.isArray(l)?l:[l],b=[...u,...n],M={...e,images:b},W=await K.updateProduct(M,w);D(B(W)),d.success("Product updated successfully"),j(-1)}catch(l){G(l)}finally{d.dismiss(r),I(!1)}},H=()=>j(-1);return a?s.jsxs($.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3},className:"space-y-6 p-4 sm:p-6 max-w-2xl mx-auto",children:[s.jsx("h3",{className:"text-lg font-semibold uppercase text-gray-800 mb-4 tracking-wide",children:"Edit Product"}),s.jsxs("form",{onSubmit:A(R),className:"space-y-4",children:[s.jsx(o,{label:"Name",name:"name",register:t,errors:i,rules:{required:"Product name is required"}}),s.jsx(o,{label:"Description",name:"description",register:t,errors:i,rules:{required:"Description is required"}}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsx(o,{label:"Price",name:"price",type:"number",register:t,errors:i,rules:{required:"Price is required",min:{value:0,message:"Must be positive"}}}),s.jsx(o,{label:"Stock",name:"stock",type:"number",register:t,errors:i,rules:{required:"Stock is required",min:{value:0,message:"Must be positive"}}})]}),s.jsx(v,{label:"Category",name:"category",register:t,errors:i,value:a.category,rules:{required:"Category is required"},options:P.map(e=>({value:e._id||e.value,label:e.name||e.label}))}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm text-gray-600 mb-1 flex items-center gap-2",children:[s.jsx(X,{size:16})," Images"]}),s.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:O,className:"w-full p-2 border border-gray-300 rounded-md text-sm text-gray-800"}),C.length>0&&s.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:C.map((e,r)=>s.jsxs("div",{className:"relative w-16 h-16",children:[s.jsx("img",{src:e,alt:`Preview ${r}`,className:"w-full h-full object-cover rounded-md"}),s.jsx("button",{type:"button",onClick:()=>E(r),className:"absolute top-0 right-0 bg-white rounded-full p-0.5 shadow-md",children:s.jsx(Y,{size:12})})]},r))})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsx(v,{label:"Fabric",name:"fabric",register:t,errors:i,rules:{required:"Fabric is required"},options:m==null?void 0:m.map(e=>({value:e._id||e.value,label:e.title||e.label})),value:a.fabric}),s.jsx(o,{label:"Technique",name:"technique",register:t,errors:i,rules:{required:"Technique is required"}})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsx(o,{label:"Color",name:"color",register:t,errors:i,rules:{required:"Color is required"}}),s.jsx(o,{label:"Weight",name:"weight",register:t,errors:i,rules:{required:"Weight is required"}})]}),s.jsx(o,{label:"Assurance",name:"assurance",register:t,errors:i,rules:{required:"Assurance is required"}}),s.jsx(o,{label:"HSN Code",name:"hsnCode",register:t,errors:i,rules:{required:"HSN Code is required",pattern:{value:/^[0-9]+$/,message:"HSN Code must contain only numbers"}}}),s.jsx(v,{label:"Offer",name:"isOfferAplied",register:t,errors:i,value:a.isOfferAplied,options:[{name:"No",value:!1},{name:"Yes",value:!0}].map(e=>({value:e._id||e.value,label:e.name||e.label,disabled:e.name=="all"}))}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[s.jsx("button",{type:"submit",disabled:x,style:{cursor:x?"not-allowed":"pointer"},className:"bg-neutral-950 text-white px-4 py-2 h-12 text-sm uppercase hover:bg-gray-700 transition-colors duration-200 shadow-md w-full",children:x?"Saving...":"Save"}),s.jsx("button",{type:"button",onClick:H,className:"bg-gray-200 text-gray-800 px-4 py-2 text-sm uppercase hover:bg-gray-300 transition-colors duration-200 shadow-md w-full",children:"Cancel"})]})]})]}):s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-gray-600 text-sm",children:"Product not found."})})};export{ae as default};
