import{a as N,j as e,I as g,r as x,l as p,av as r,ay as C,m as b,a7 as w,aO as A,Y as S}from"./index-Bn0qEctH.js";import{S as f}from"./SelectField-DiPLyfOK.js";function L({defaultValues:s={},onSubmit:u,onCancel:h}){const{register:o,handleSubmit:a,formState:{errors:i,isSubmitting:l}}=N({defaultValues:{code:(s==null?void 0:s.code)||"",discount:(s==null?void 0:s.discount)??"",maxAge:(s==null?void 0:s.maxAge)??"",maxUsageLimit:(s==null?void 0:s.maxUsageLimit)??"",status:s!=null&&s.status?"active":"inactive"}}),c=n=>{u({code:n.code.trim().toLowerCase(),discount:Number(n.discount),maxAge:Number(n.maxAge),maxUsageLimit:Number(n.maxUsageLimit),status:n.status==="active"})};return e.jsxs("form",{onSubmit:a(c),className:"space-y-4",children:[e.jsx(g,{label:"Coupon Code",name:"code",register:o,errors:i,rules:{required:"Code is required"}}),e.jsx(g,{label:"Discount (%)",name:"discount",type:"number",register:o,errors:i,rules:{required:"Discount is required",min:{value:0,message:"Min 0%"},max:{value:51,message:"Max 51%"}}}),e.jsx(g,{label:"Max Age (hrs)",name:"maxAge",type:"number",register:o,errors:i,rules:{required:"Max age is required",min:{value:1,message:"Min 1 hour"}}}),e.jsx(g,{label:"Usage Limit",name:"maxUsageLimit",type:"number",register:o,errors:i,rules:{required:"Limit is required",min:{value:1,message:"Min 1 use"}}}),e.jsx(f,{label:"Status",name:"status",register:o,errors:i,rules:{required:"Status is required"},options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",disabled:l,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-700",disabled:l,children:s!=null&&s._id?"Update":"Create"})]})]})}function q(){const[s,u]=x.useState([]),[h,o]=x.useState(!0),[a,i]=x.useState(null),[l,c]=x.useState(!1);x.useEffect(()=>{n()},[]);const n=async()=>{o(!0);try{const{data:t}=await p.get("/admin/coupon/");u(t.data)}catch(t){console.error(t),r.error("Failed to load coupons")}finally{o(!1)}},j=async t=>{const d=a.mode==="edit";c(!0);const m=r.loading(d?"Updating…":"Creating…");try{d?(await p.put(`/admin/coupon/${a.coupon._id}`,t),r.success("Coupon updated",{id:m})):(await p.post("/admin/coupon/create",t),r.success("Coupon created",{id:m})),i(null),n()}catch(y){console.error(y),r.error("Save failed",{id:m})}finally{c(!1)}},v=async()=>{c(!0);const t=r.loading("Deleting…");try{await p.delete(`/admin/coupon/${a.coupon._id}`),r.success("Coupon deleted",{id:t}),i(null),n()}catch(d){console.error(d),r.error("Delete failed",{id:t})}finally{c(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Coupons"}),e.jsxs("button",{onClick:()=>i({mode:"create",coupon:null}),className:"flex items-center gap-2 bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-700",children:[e.jsx(C,{})," Add Coupon"]})]}),h?e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]}):s.length===0?e.jsx("p",{className:"text-gray-600",children:"No coupons available."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.map(t=>e.jsxs(b.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-700",children:t.code.toUpperCase()}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-700",children:"Discount:"})," ",t.discount,"%"]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-700",children:"Max Age:"})," ",t.maxAge," hrs"]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-700",children:"Usage Limit:"})," ",t.maxUsageLimit]}),e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-700",children:"Status:"})," ",t.status?"Active":"Inactive"]}),(()=>{const d=new Date(t.createdAt).getTime(),m=t.maxAge*60*60*1e3,y=Date.now()>d+m;return e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-700",children:"Expired:"})," ",y?"Yes":"No"]})})(),e.jsxs("div",{className:"flex gap-3 mt-3",children:[e.jsxs("button",{onClick:()=>i({mode:"edit",coupon:t}),className:"flex items-center gap-1 text-blue-600 hover:text-blue-800",children:[e.jsx(w,{})," Edit"]}),e.jsxs("button",{onClick:()=>i({mode:"delete",coupon:t}),className:"flex items-center gap-1 text-red-600 hover:text-red-800",children:[e.jsx(A,{})," Delete"]})]})]},t._id))}),a&&(a.mode==="create"||a.mode==="edit")&&e.jsx("div",{className:"fixed inset-0 glass bg-opacity-30 flex items-center justify-center z-50 p-4",children:e.jsxs(b.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white w-full max-w-md rounded-lg shadow-lg p-6 relative",children:[e.jsx("button",{onClick:()=>i(null),className:"absolute top-4 right-4 text-gray-600 hover:text-gray-800",children:e.jsx(S,{})}),e.jsx("h3",{className:"text-xl font-medium mb-4",children:a.mode==="edit"?"Edit Coupon":"New Coupon"}),e.jsx(L,{defaultValues:a.coupon,onSubmit:j,onCancel:()=>i(null)})]})}),a&&a.mode==="delete"&&e.jsx("div",{className:"fixed inset-0 glass bg-opacity-30 flex items-center justify-center z-50 p-4",children:e.jsxs(b.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},className:"bg-white max-w-sm w-full rounded-lg shadow-lg p-6",children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"Delete Coupon?"}),e.jsxs("p",{className:"mb-4 text-gray-700",children:["Code:"," ",e.jsx("strong",{children:a.coupon.code.toUpperCase()})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>i(null),className:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{onClick:v,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",disabled:l,children:l?"Deleting…":"Delete"})]})]})})]})}export{q as default};
