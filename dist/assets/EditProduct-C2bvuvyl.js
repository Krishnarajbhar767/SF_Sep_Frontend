import{u as z,g as L,d as w,a as T,r as u,e as W,j as a,m as Y,I as o,aE as X,Y as B,V as d,aF as G,h as J}from"./index-Bn0qEctH.js";import{S as g}from"./SelectField-DiPLyfOK.js";import{u as K}from"./uploadMedia-D5RVChhy.js";import{p as Q}from"./product.api-DhYHF8FM.js";import{u as Z}from"./useOffer-m-FiyNde.js";const te=()=>{const N=z(),{id:S}=L(),f=w(s=>s.fabrics),{products:h}=w(s=>s.product),x=w(s=>s.category.categories||[]),e=h==null?void 0:h.find(s=>s._id===S),b=Z(),{register:l,handleSubmit:F,formState:{errors:n},reset:C,watch:P}=T(),[c,D]=u.useState([]),[p,A]=u.useState([]),[m,y]=u.useState([]),[v,O]=u.useState(null),[j,I]=u.useState(!1),k=P(),_=W();u.useEffect(()=>{var s,i;if(e){const r={name:e==null?void 0:e.name,description:e==null?void 0:e.description,price:e==null?void 0:e.price,stock:e==null?void 0:e.stock,category:((s=e==null?void 0:e.category)==null?void 0:s._id)||(e==null?void 0:e.category),fabric:(i=e==null?void 0:e.fabric)==null?void 0:i._id,technique:e==null?void 0:e.technique,color:e==null?void 0:e.color,weight:e==null?void 0:e.weight,assurance:e==null?void 0:e.assurance,hsnCode:e==null?void 0:e.hsnCode,isOfferAplied:e==null?void 0:e.isOfferAplied,offerDiscount:e==null?void 0:e.offerDiscount};C(r),O(r);const t=Array.isArray(e.images)?e==null?void 0:e.images:[];D(t),y(t)}},[e,C]);const E=s=>{const i=Array.from(s.target.files);A(t=>[...t,...i]);const r=i.map(t=>URL.createObjectURL(t));y(t=>[...t,...r])},U=s=>{if(y(i=>i.filter((r,t)=>t!==s)),s<c.length)D(i=>i.filter((r,t)=>t!==s));else{const i=s-c.length;A(r=>r.filter((t,q)=>q!==i))}},R=()=>{var s;if(!v)return!1;for(let i in v)if(String(k[i])!==String(v[i]))return!0;return p.length>0||(c==null?void 0:c.length)!==(((s=e==null?void 0:e.images)==null?void 0:s.length)||0)},H=async s=>{if(!R()){d.error("No changes detected.");return}I(!0);const i=d.loading("Please wait...");try{let r=[];p.length>0&&(r=await K(p,s));const t=Array.isArray(r)?r:[r],q=[...c,...t],V={...s,images:q},$=await Q.updateProduct(V,S);_(G($)),d.success("Product updated successfully"),N(-1)}catch(r){J(r)}finally{d.dismiss(i),I(!1)}},M=()=>N(-1);return e?(console.log("Offer Discount Value:",e==null?void 0:e.offerDiscount,typeof(e==null?void 0:e.offerDiscount)),a.jsxs(Y.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3},className:"space-y-6 p-4 sm:p-6 max-w-2xl mx-auto",children:[a.jsx("h3",{className:"text-lg font-semibold uppercase text-gray-800 mb-4 tracking-wide",children:"Edit Product"}),a.jsxs("form",{onSubmit:F(H),className:"space-y-4",children:[a.jsx(o,{label:"Name",name:"name",register:l,errors:n,rules:{required:"Product name is required"}}),a.jsx(o,{label:"Description",name:"description",register:l,errors:n,rules:{required:"Description is required"}}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsx(o,{label:"Price",name:"price",type:"number",register:l,errors:n,rules:{required:"Price is required",min:{value:0,message:"Must be positive"}}}),a.jsx(o,{label:"Stock",name:"stock",type:"number",register:l,errors:n,rules:{required:"Stock is required",min:{value:0,message:"Must be positive"}}})]}),a.jsx(g,{label:"Category",name:"category",register:l,errors:n,value:e==null?void 0:e.category,rules:{required:"Category is required"},options:x==null?void 0:x.map(s=>({value:s._id||s.value,label:s.name||s.label}))}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm text-gray-600 mb-1 flex items-center gap-2",children:[a.jsx(X,{size:16})," Images"]}),a.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:E,className:"w-full p-2 border border-gray-300 rounded-md text-sm text-gray-800"}),m.length>0&&a.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:m==null?void 0:m.map((s,i)=>a.jsxs("div",{className:"relative w-16 h-16",children:[a.jsx("img",{src:s,alt:`${i}`,className:"w-full h-full object-cover rounded-md"}),a.jsx("button",{type:"button",onClick:()=>U(i),className:"absolute top-0 right-0 bg-white rounded-full p-0.5 shadow-md",children:a.jsx(B,{size:12})})]},i))})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsx(g,{label:"Fabric",name:"fabric",register:l,errors:n,rules:{required:"Fabric is required"},options:f==null?void 0:f.map(s=>({value:s._id||s.value,label:s.title||s.label})),value:e.fabric}),a.jsx(o,{label:"Technique",name:"technique",register:l,errors:n,rules:{required:"Technique is required"}})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsx(o,{label:"Color",name:"color",register:l,errors:n,rules:{required:"Color is required"}}),a.jsx(o,{label:"Weight",name:"weight",register:l,errors:n,rules:{required:"Weight is required"}})]}),a.jsx(o,{label:"Assurance",name:"assurance",register:l,errors:n,rules:{required:"Assurance is required"}}),a.jsx(o,{label:"HSN Code",name:"hsnCode",register:l,errors:n,rules:{required:"HSN Code is required",pattern:{value:/^[0-9]+$/,message:"HSN Code must contain only numbers"}}}),a.jsx(g,{label:"Offer Discount",name:"offerDiscount",register:l,errors:n,value:e==null?void 0:e.offerDiscount,options:[...b==null?void 0:b.map(s=>({value:String(s.discount),label:`Discount ${s.discount}%`})),{value:0,label:"No Offer"}]}),a.jsx(g,{label:"Offer",name:"isOfferAplied",register:l,errors:n,value:e==null?void 0:e.isOfferAplied,options:[{name:"No",value:!1},{name:"Yes",value:!0}].map(s=>({value:s._id||s.value,label:s.name||s.label,disabled:s.name=="all"}))}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[a.jsx("button",{type:"submit",disabled:j,style:{cursor:j?"not-allowed":"pointer"},className:"bg-neutral-950 text-white px-4 py-2 h-12 text-sm uppercase hover:bg-gray-700 transition-colors duration-200 shadow-md w-full",children:j?"Saving...":"Save"}),a.jsx("button",{type:"button",onClick:M,className:"bg-gray-200 text-gray-800 px-4 py-2 text-sm uppercase hover:bg-gray-300 transition-colors duration-200 shadow-md w-full",children:"Cancel"})]})]})]})):a.jsx("div",{className:"text-center py-8",children:a.jsx("p",{className:"text-gray-600 text-sm",children:"Product not found."})})};export{te as default};
