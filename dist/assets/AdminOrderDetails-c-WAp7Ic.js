import{r as f,a as O,j as e,Y as C,aG as k,I as F,l as I,h as R,g as T,u as L,m as N,aa as z,aH as M,aI as _,b as E,am as $,a5 as S,aJ as q,aK as W,aL as H}from"./index-Bn0qEctH.js";import{u as B}from"./uploadMedia-D5RVChhy.js";import{F as w,T as P}from"./Constant-B8kb6R2V.js";import{R as G}from"./ReceiptPreview-BFp0XLh_.js";const Y=({isOpen:s,onClose:t,orderId:l})=>{const[n,r]=f.useState(null),[x,d]=f.useState(null),[u,m]=f.useState(!1),h=f.useRef(null),{register:i,handleSubmit:j,formState:{errors:a},reset:b}=O();if(!s)return null;const p=o=>{const c=o.target.files[0];if(c)if(r(c),c.type.startsWith("image/")){const v=URL.createObjectURL(c);d(v)}else d(null)},g=o=>{o.preventDefault();const c=o.dataTransfer.files[0];if(c)if(r(c),c.type.startsWith("image/")){const v=URL.createObjectURL(c);d(v)}else d(null)},y=async o=>{if(n){m(!0);try{const c=await B([n],{name:"order_reciept"});console.log("Receipt Image URL",c),console.log("Receipt Form Data........",o);const v=c.secure_url||c[0],D=await I.post("/admin/orders/updateDelhiveryReceipt",{delhiveryReceipt:v,orderId:l,...o});console.log("Receipt Upload Response",D),D&&(r(null),d(null),t())}catch(c){R(c)}finally{m(!1)}}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center glass h-full bg-opacity-50 backdrop-blur-sm transition-all overflow-hidden",onClick:t,children:e.jsxs("div",{className:"h-[95%] overflow-y-scroll relative bg-white w-[90%] sm:w-[500px] max-w-[95%] rounded-lg shadow-xl p-6",onClick:o=>o.stopPropagation(),children:[e.jsx("button",{onClick:t,className:"absolute top-4 right-4 text-gray-400 hover:text-red-500",children:e.jsx(C,{size:20})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Upload Delhivery Receipt & Other Data"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-400 transition-colors",onClick:()=>h.current.click(),onDrop:g,onDragOver:o=>o.preventDefault(),children:[e.jsx(k,{className:"mx-auto text-4xl text-blue-500 mb-2"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["Drag & drop a file here or"," ",e.jsx("span",{className:"text-blue-600 underline",children:"click to browse"})]}),e.jsx("p",{children:"MAX 10MB"}),n&&x&&e.jsxs("div",{className:"mt-4",children:[e.jsx("img",{src:x,alt:"Preview",className:"mx-auto max-h-48 rounded shadow"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:n.name})]}),n&&!x&&e.jsxs("p",{className:"mt-3 text-sm text-green-600 font-medium",children:["Selected: ",n.name]}),e.jsx("input",{type:"file",accept:"application/pdf,image/*",ref:h,onChange:p,className:"hidden"})]}),e.jsxs("form",{className:"mt-4 space-y-4",children:[e.jsx(F,{register:i,name:"trackingId",type:"text",label:"Enter Tracking Id",errors:a,rules:{required:"Tracking id is required*"}}),e.jsx(F,{register:i,name:"parcelWeight",type:"text",label:"Enter Parcel Weight (e.g 500gm, 1kg)",errors:a,rules:{required:"Parcel Weight is required*"}}),e.jsx(F,{register:i,name:"deliveryPartner",type:"text",label:"Enter delivery partner name",errors:a,rules:{required:"Delivery partner is required*"}})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-sm text-gray-700 border border-gray-300 rounded hover:bg-gray-100",disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",onClick:j(y),disabled:!n||u,className:`px-4 py-2 text-sm text-white rounded ${n&&!u?"bg-gray-900 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"}`,children:u?"Uploading...":"Upload"})]})]})})},Q=({receipt:s,printRef:t})=>{var x,d,u,m,h,i,j;const l=a=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:2}).format(a),n=a=>{const b=(a==null?void 0:a.price)||0,p=(a!=null&&a.withFallPico?w:0)+(a!=null&&a.withTassels?P:0),g=b+p;return{finalPricePerUnit:g,total:g*(a==null?void 0:a.quantity)}},r=(x=s==null?void 0:s.items)==null?void 0:x.reduce((a,b)=>{const{total:p}=n(b);return a+p},0);return e.jsx("div",{className:"p-4 hidden",children:e.jsxs("div",{ref:t,className:"mt-6 p-6 bg-white shadow-lg rounded text-sm font-sans",children:[e.jsxs("div",{className:"border-b pb-4 mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-1",children:"Order Receipt"}),e.jsxs("p",{className:"text-gray-600",children:["Order ID: ",s==null?void 0:s.id]}),e.jsxs("p",{className:"text-gray-600",children:["Date: ",new Date(s==null?void 0:s.date).toLocaleString()]})]}),e.jsxs("div",{className:"mb-6 capitalize",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Customer Info"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",s==null?void 0:s.customerName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s==null?void 0:s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",s==null?void 0:s.phone]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",s!=null&&s.shippingAddress?`${(d=s==null?void 0:s.shippingAddress)==null?void 0:d.street}, ${(u=s==null?void 0:s.shippingAddress)==null?void 0:u.city}, ${(m=s==null?void 0:s.shippingAddress)==null?void 0:m.postalCode},${(h=s==null?void 0:s.shippingAddress)==null?void 0:h.state}, ${(i=s==null?void 0:s.shippingAddress)==null?void 0:i.country}`:"N/A"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Order Items"}),e.jsxs("table",{className:"min-w-full table-auto border border-gray-300 text-xs sm:text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border p-2 text-left",children:"Product"}),e.jsx("th",{className:"border p-2",children:"Qty"}),e.jsx("th",{className:"border p-2",children:"With Fall Pico"}),e.jsx("th",{className:"border p-2",children:"With Tassels"}),e.jsx("th",{className:"border p-2",children:"Unit Price"}),e.jsx("th",{className:"border p-2",children:"Total"})]})}),e.jsx("tbody",{children:(j=s==null?void 0:s.items)==null?void 0:j.map((a,b)=>{var y;const{finalPricePerUnit:p,total:g}=n(a);return e.jsxs("tr",{className:"text-center",children:[e.jsx("td",{className:"border p-2 text-left",children:((y=a==null?void 0:a.product)==null?void 0:y.name)||"Product"}),e.jsx("td",{className:"border p-2",children:a==null?void 0:a.quantity}),e.jsx("td",{className:"border p-2",children:a!=null&&a.withFallPico?`Yes +â‚¹${w}`:"No"}),e.jsx("td",{className:"border p-2",children:a!=null&&a.withTassels?`Yes +â‚¹${P}`:"No"}),e.jsx("td",{className:"border p-2",children:l(p)}),e.jsx("td",{className:"border p-2",children:l(g)})]},b)})})]})]}),e.jsxs("div",{className:"text-right mb-6",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Amount (Inclusive of 5% GST):"})," ",l(r)]}),e.jsx("p",{className:"text-gray-600 italic",children:"GST (5%) is already included in the above amount."}),e.jsxs("p",{children:[e.jsx("strong",{children:"Shipping:"})," ",(s==null?void 0:s.shipping)||"Free"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment Method:"})," ",(s==null?void 0:s.paymentMethod)||"N/A"]})]}),e.jsxs("div",{className:"border-t pt-4 text-center text-sm",children:[e.jsx("p",{className:"font-semibold text-base",children:"Thank you for shopping with us!"}),e.jsx("p",{className:"text-gray-700",children:"Srijan Fabs Pvt. Ltd."}),e.jsx("p",{className:"text-gray-700",children:"Contact: +91 89605 00991"})]})]})})},A={hidden:{opacity:0,y:20},visible:s=>({opacity:1,y:0,transition:{delay:s*.2,duration:.4}})},U=({status:s,type:t="default"})=>{const l=(s||"").toLowerCase();let n="bg-gray-50 text-gray-700 border-gray-200";return t==="payment"?l==="paid"?n="bg-emerald-50 text-emerald-700 border-emerald-200":["failed","pending"].includes(l)&&(n="bg-red-50 text-red-700 border-red-200"):l==="delivered"?n="bg-emerald-50 text-emerald-700 border-emerald-200":["shipped","out for delivery"].includes(l)?n="bg-blue-50 text-blue-700 border-blue-200":l==="pending"?n="bg-amber-50 text-amber-700 border-amber-200":l==="canceled"&&(n="bg-red-50 text-red-700 border-red-200"),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${n}`,children:s||"N/A"})},X=({order:s,onPrint:t})=>{const[l,n]=f.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(N.div,{custom:0,initial:"hidden",animate:"visible",variants:A,className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Admin Order Management"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Order ID:"," ",e.jsx("span",{className:"font-mono",children:(s==null?void 0:s.razorpay_order_id)||"N/A"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-800 hover:text-blue-600 border rounded bg-gray-100",children:[e.jsx(M,{size:18})," Print Receipt"]}),e.jsxs("button",{onClick:()=>n(!0),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-800 hover:text-blue-600 border rounded bg-gray-100",children:[e.jsx(_,{size:18})," Upload Delhivery Receipt"]}),e.jsxs(E,{to:"/admin/orders",className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-800 hover:text-blue-600",children:[e.jsx($,{size:16})," Back to Orders"]})]})]}),e.jsx(Y,{isOpen:l,onClose:()=>n(!1),orderId:s==null?void 0:s._id})]})},J=({user:s})=>e.jsxs(N.div,{custom:1,initial:"hidden",animate:"visible",variants:A,className:"space-y-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-xl font-semibold text-gray-800",children:[e.jsx(S,{size:20})," Customer Information"]}),e.jsx("div",{className:"bg-purple-50 border-purple-100 rounded-xl p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(S,{size:20,className:"text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Customer Name"}),e.jsx("p",{className:"font-semibold text-gray-800 capitalize",children:((s==null?void 0:s.firstName)||"")+" "+((s==null?void 0:s.lastName)||"")})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(q,{size:20,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email Address"}),e.jsx("p",{className:"font-medium text-gray-800 lowercase",children:(s==null?void 0:s.email)||"N/A"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(W,{size:20,className:"text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Phone Number"}),e.jsx("p",{className:"font-semibold text-gray-800",children:(s==null?void 0:s.phone)||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(H,{size:20,className:"text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Customer ID"}),e.jsx("p",{className:"font-mono text-sm text-gray-800",children:(s==null?void 0:s._id)||"N/A"})]})]})]})]})})]}),K=({order:s,formatINR:t})=>{const l=((s==null?void 0:s.totalAmount)||0)+(typeof(s==null?void 0:s.discount)=="number"&&s.discount>0?s.discount:0);return e.jsx(N.div,{custom:2,initial:"hidden",animate:"visible",variants:A,className:"bg-blue-50 border-blue-100 rounded-xl p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Order Date"}),e.jsx("p",{className:"text-sm font-medium text-gray-800",children:new Date(s.createdAt).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.createdAt).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Gross Amount"}),e.jsxs("p",{className:"text-sm font-medium text-gray-800",children:["â‚¹",t(l)]})]}),typeof(s==null?void 0:s.discount)=="number"&&s.discount>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Coupon Discount"}),e.jsxs("p",{className:"text-sm font-medium text-red-600",children:["- â‚¹",t(s.discount)]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Net Payable"}),e.jsxs("p",{className:"text-xl font-bold text-gray-800",children:["â‚¹",t(s.totalAmount||0)]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Payment Status"}),e.jsx(U,{status:s.paymentStatus,type:"payment"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Delivery Status"}),e.jsx(U,{status:s.deliveryStatus})]})]})})},V=({item:s,index:t,formatINR:l})=>{const n=L(),r=(s==null?void 0:s.product)||{},x=r.name||"Unnamed Product",d=typeof r.price=="number"?r.price:0,u=Array.isArray(r.images)?r.images:[],m=(s==null?void 0:s.quantity)||0,h=r.isOfferAplied===!0,i=h&&typeof r.offerDiscount=="number"?r.offerDiscount:0,j=s!=null&&s.withFallPico?w:0,a=s!=null&&s.withTassels?P:0,b=j+a,p=h?d*i/100:0,g=d-p,y=g+b,o=y*m;return e.jsx(N.div,{whileHover:{scale:1.01},transition:{duration:.2},className:"bg-white border-gray-200 rounded-xl p-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6",children:[e.jsx("img",{onClick:()=>r._id&&n(`/product/${r._id}`),src:u[0]||"/Product_Placeholder.webp",alt:x,className:"w-24 h-24 sm:w-28 sm:h-28 object-cover rounded-sm cursor-pointer"}),e.jsxs("div",{className:"flex-1 space-y-4 text-sm text-gray-700",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800 capitalize",children:x}),e.jsxs("div",{className:"flex gap-4 mt-1 text-xs text-gray-500",children:[e.jsxs("span",{children:["Product ID: ",e.jsx("code",{children:r._id||"N/A"})]}),e.jsxs("span",{children:["Qty: ",e.jsx("strong",{children:m})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[e.jsx("h5",{className:"text-sm font-bold text-gray-900",children:"ðŸ§¾ Price Summary"}),e.jsxs("div",{className:"flex justify-between font-semibold text-gray-700",children:[e.jsx("span",{children:"Base Price"}),e.jsxs("span",{children:["â‚¹",l(d)]})]}),h&&i>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsxs("span",{children:["Offer Discount (",i,"%)"]}),e.jsxs("span",{children:["- â‚¹",l(p)]})]}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"After Offer"}),e.jsxs("span",{children:["â‚¹",l(g)]})]})]}):e.jsxs("div",{className:"flex justify-between font-medium text-gray-600",children:[e.jsx("span",{children:"Offer Not Applied"}),e.jsxs("span",{children:["â‚¹",l(d)]})]}),(j>0||a>0)&&e.jsxs("div",{className:"space-y-1 pt-2",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Addâ€‘ons"}),j>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"+ Fall Pico"}),e.jsxs("span",{children:["+ â‚¹",w]})]}),a>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"+ Tassels"}),e.jsxs("span",{children:["+ â‚¹",P]})]})]}),e.jsxs("div",{className:"border-t pt-2 space-y-1",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Final Unit Price"}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Unit Price"}),e.jsxs("span",{children:["â‚¹",l(y)]})]})]}),e.jsxs("div",{className:"border-t pt-2 space-y-1",children:[e.jsx("p",{className:"font-semibold text-gray-700",children:"Gross Total"}),e.jsxs("div",{className:"flex justify-between font-bold text-gray-800",children:[e.jsxs("span",{children:[m," Ã— â‚¹",l(y)]}),e.jsxs("span",{children:["â‚¹",l(o)]})]})]})]})]})]})},t)},te=()=>{var m,h;const{id:s}=T(),[t,l]=f.useState(null),[n,r]=f.useState(!0),x=f.useRef();L(),f.useEffect(()=>{r(!0),I.get(`/admin/orders/order/${s}`).then(i=>{l(i.data.data),r(!1)}).catch(i=>{console.error(i),l(null),r(!1)})},[s]);const d=i=>(i||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2});if(n)return e.jsxs("div",{children:[" ","Loading..."]});if(!t)return e.jsx("div",{children:"No order found."});const u=()=>{const i=document.body.innerHTML;document.body.innerHTML=x.current.innerHTML,window.print(),document.body.innerHTML=i,window.location.reload()};return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs(N.div,{className:"space-y-8",children:[e.jsx(X,{order:t,onPrint:u}),e.jsx(J,{user:t.user}),e.jsx(K,{order:t,formatINR:d}),e.jsxs(N.div,{custom:3,initial:"hidden",animate:"visible",variants:A,className:"space-y-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-xl font-semibold text-gray-800",children:[e.jsx(z,{size:20})," Order Items (",((m=t.items)==null?void 0:m.length)||0,")"]}),e.jsx("div",{className:"space-y-4",children:(h=t.items)==null?void 0:h.map((i,j)=>e.jsx(V,{item:i,index:j,formatINR:d},i._id||j))})]}),e.jsx(G,{imageUrl:t==null?void 0:t.delhiveryReceipt,trackingId:t==null?void 0:t.trackingId,parcelWeight:t==null?void 0:t.parcelWeight,deliveryPartner:t==null?void 0:t.deliveryPartner}),e.jsx(Q,{receipt:{},printRef:x})]})})})};export{te as default};
